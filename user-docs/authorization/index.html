
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AWS Controllers for Kubernetes">
      
      
      
        <meta name="author" content="The ACK contributors">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.5">
    
    
      
        <title>Authorization - ACK</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#ffa724">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oxygen:300,400,400i,700%7COxygen+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Oxygen";--md-code-font-family:"Oxygen Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="orange" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#authorization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ACK" class="md-header__button md-logo" aria-label="ACK" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ACK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authorization
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/aws/aws-controllers-k8s/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-controllers-k8s
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../wip/" class="md-tabs__link">
        User docs
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../dev-docs/overview/" class="md-tabs__link">
        Contributor docs
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../community/background/" class="md-tabs__link">
        Community
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ACK" class="md-nav__button md-logo" aria-label="ACK" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    ACK
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/aws/aws-controllers-k8s/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-controllers-k8s
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      <label class="md-nav__link" for="__nav_1">
        Home
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../services/" class="md-nav__link">
        Services
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        User docs
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../wip/" class="md-nav__link">
        Install
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../wip/" class="md-nav__link">
        Permissions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../wip/" class="md-nav__link">
        Usage
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Contributor docs
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Contributor docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Contributor docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dev-docs/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dev-docs/code-generation/" class="md-nav__link">
        Code generation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dev-docs/setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dev-docs/building-controller/" class="md-nav__link">
        Building controller
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dev-docs/testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Community
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Community" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Community
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../community/background/" class="md-nav__link">
        Background
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../community/faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../community/discussions/" class="md-nav__link">
        Discussions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/aws/aws-controllers-k8s/blob/master/CONTRIBUTING.md" class="md-nav__link">
        Contributing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/aws/aws-controllers-k8s/blob/master/GOVERNANCE.md" class="md-nav__link">
        Governance
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configure-permissions" class="md-nav__link">
    Configure permissions
  </a>
  
    <nav class="md-nav" aria-label="Configure permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-kubernetes-rbac" class="md-nav__link">
    Configuring Kubernetes RBAC
  </a>
  
    <nav class="md-nav" aria-label="Configuring Kubernetes RBAC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bind-a-kubernetes-user-to-a-kubernetes-role" class="md-nav__link">
    Bind a Kubernetes User to a Kubernetes Role
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-aws-iam" class="md-nav__link">
    Configuring AWS IAM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-account-resource-management" class="md-nav__link">
    Cross-account resource management
  </a>
  
    <nav class="md-nav" aria-label="Cross-account resource management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-aws-accounts" class="md-nav__link">
    Setting up AWS accounts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map-aws-accounts-with-their-associated-role-arns" class="md-nav__link">
    Map AWS Accounts with their associated Role ARNs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-accounts-to-namespaces" class="md-nav__link">
    Bind accounts to namespaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-resource-in-different-aws-accounts" class="md-nav__link">
    Create resource in different AWS accounts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws/aws-controllers-k8s/edit/master/docs/user-docs/authorization.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="authorization">Authorization<a class="headerlink" href="#authorization" title="Permanent link">&para;</a></h1>
<p>When we talk about authorization and access control for ACK, we need to discuss
two different Role-based Access Control (RBAC) systems.</p>
<p>Remember that <a href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/">Kubernetes RBAC</a> governs a <strong>Kubernetes</strong> user's ability to
read or write <strong>Kubernetes resources</strong>. In the case of ACK, this means that
Kubernetes RBAC system controls the ability of a Kubernetes user to read or
write different custom resources (CRs) that ACK service controllers use.</p>
<p>On the other end of the authorization spectrum, you can use AWS Identity and
Access Management (IAM) <strong>Policies</strong> to governs the ability of an <strong>AWS IAM
Role</strong> to read or write certain <strong>AWS resources</strong>.</p>
<div class="admonition note">
<p class="admonition-title">IAM is more than RBAC</p>
<p>AWS IAM is more than just an RBAC system. It handles
authentication/identification and can be used to build Attribute-based
Access Control (ABAC) systems. In this document, however, we're focusing on
using IAM primitives to establish an RBAC system.</p>
</div>
<p><strong>These two RBAC systems do not overlap</strong>. The Kubernetes user that calls the
Kubernetes API via calls to <code>kubectl</code> <strong>has no association with an IAM Role</strong>.
Instead, it is the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/"><code>ServiceAccount</code></a> running the ACK service controller's
<code>Pod</code> that is associated with an IAM Role and is thus governed by the IAM RBAC
system.</p>
<p><img alt="Authorization in ACK" src="../../images/authorization.png" /></p>
<div class="admonition note">
<p class="admonition-title">RBAC authorization mode</p>
<p>The above diagram assumes you are running Kubernetes API server with
the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html">RBAC authorization mode</a> enabled.</p>
</div>
<h2 id="configure-permissions">Configure permissions<a class="headerlink" href="#configure-permissions" title="Permanent link">&para;</a></h2>
<p>Because ACK bridges the Kubernetes and AWS APIs, before using ACK service
controllers, you will need to do some initial configuration around Kubernetes
and AWS Identity and Access Management (IAM) permissions.</p>
<h3 id="configuring-kubernetes-rbac">Configuring Kubernetes RBAC<a class="headerlink" href="#configuring-kubernetes-rbac" title="Permanent link">&para;</a></h3>
<p>As part of installation, certain Kubernetes <code>Role</code> resources will be created
that contain permissions to modify the Kubernetes custom resources (CRs) that
the ACK service controller is responsible for.</p>
<div class="admonition note">
<p class="admonition-title">Important</p>
<p>All Kubernetes CRs managed by an ACK service controller are
Namespaced resources; that is, there are no cluster-scoped ACK-managed CRs.</p>
</div>
<p>By default, the following Kubernetes <code>Role</code> resources are created when
installing an ACK service controller:</p>
<ul>
<li><code>ack-$SERVICE-writer</code>: a <code>Role</code> used for reading and mutating
  namespace-scoped custom resources that the service controller manages.</li>
<li><code>ack-$SERVICE-reader</code>: a <code>Role</code> used for reading namespaced-scoped custom
  resources that the service controller manages.</li>
</ul>
<p>When installing a service controller, if the <code>Role</code> already exists (because an
ACK controller for a different AWS service has previously been installed),
permissions to manage CRDs and CRs associated with the installed controller's
AWS service are added to the existing <code>Role</code>.</p>
<p>For example, if you installed the ACK service controller for AWS S3, during
that installation process, the <code>ack-s3-writerr</code> <code>Role</code> would have been granted
read/write permissions to create CRs with a <code>GroupKind</code> of
<code>s3.services.k8s.aws/Bucket</code> within a specific Kubernetes <code>Namespace</code>.
Likewise the <code>ack-s3-reader</code> <code>Role</code> would have been granted read permissions to
view CRs with a <code>GroupKind</code> of <code>s3.services.k8s.aws/Bucket</code>.</p>
<p>If you later installed the ACK service controller for AWS SNS, the installation
process would have added permissions to the <code>ack-sns-writer</code> <code>Role</code> to
read/write CRs of <code>GroupKind</code> <code>sns.services.k8s.aws/Topic</code> and added
permissions to the <code>ack-sns-reader</code> <code>Role</code> to read CRs of <code>GroupKind</code>
<code>sns.services.k8s.aws/Topic</code>.</p>
<p>If you would like to use a differently-named Kubernetes <code>Role</code> than the
defaults, you are welcome to do so by modifying the Kubernetes manifests that
are used as part of the installation process.</p>
<h4 id="bind-a-kubernetes-user-to-a-kubernetes-role">Bind a Kubernetes User to a Kubernetes Role<a class="headerlink" href="#bind-a-kubernetes-user-to-a-kubernetes-role" title="Permanent link">&para;</a></h4>
<p>Once the Kubernetes <code>Role</code> resources have been created, you will want to assign
a specific Kubernetes <code>User</code> to a particular <code>Role</code>. You do this using standard
Kubernetes <code>RoleBinding</code> resource.</p>
<p>For example, assume you want to have the Kubernetes <code>User</code> named "alice" have
the ability to create, read, delete and modify S3 Buckets in the "testing"
Kubernetes <code>Namespace</code> and the ability to just read SNS Topic CRs in the
Kubernetes "production" <code>Namespace</code> you would execute the following commands:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>kubectl create rolebinding alice-ack-s3-writer --role ack-s3-writer --namespace testing --user alice
kubectl create rolebinding alice-ack-sns--reader --role ack-sns-reader --namespace production --user alice
</code></pre></div>
</td></tr></table>
<p>As always, if you are curious whether a particular Kubernetes user can perform
some action on a Kubernetes resource, you can use the <code>kubectl auth can-i</code>
command, like this example shows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>kubectl auth can-i create buckets --namespace default
</code></pre></div>
</td></tr></table>
<h3 id="configuring-aws-iam">Configuring AWS IAM<a class="headerlink" href="#configuring-aws-iam" title="Permanent link">&para;</a></h3>
<p>Since ACK service controllers bridge the Kubernetes and AWS API worlds, in
addition to configuring Kubernetes RBAC permissions, you will need to ensure
that all AWS Identity and Access Management (IAM) roles and permissions have
been properly created.</p>
<p>The IAM Role that your ACK service controller runs as will need a different set
of <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html">IAM Policies</a> depending on which AWS service API the service controller
is managing. For instance, the ACK service controller for S3 will need
permissions to read and write S3 Buckets.</p>
<p>We include with each service controller a recommended IAM Policy that restricts
the ACK service controller to taking only the actions that the IAM Role needs
to properly manage resources for that specific AWS service API. Within each
service controller's source code directory is a <code>config/iam/recommended-policy-arn</code>
document that contains the AWS Resource Name (ARN) of the recommended managed
policy for that service and can be applied to the IAM Role for the ACK service
controller by calling <code>aws iam attach-role-policy</code> on the contents of that file:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nv">SERVICE</span><span class="o">=</span>s3
<span class="nv">BASE_URL</span><span class="o">=</span>https://github.com/aws/aws-controllers-k8s/blob/main/services
<span class="nv">POLICY_URL</span><span class="o">=</span><span class="nv">$BASE_URL</span>/<span class="nv">$SERVICE</span>/config/iam/recommended-policy-arn
<span class="nv">POLICY_ARN</span><span class="o">=</span><span class="s2">&quot;`wget -qO- </span><span class="nv">$POLICY_URL</span><span class="s2">`&quot;</span>
aws iam attach-role-policy <span class="se">\</span>
    --role-name <span class="nv">$IAM_ROLE</span> <span class="se">\</span>
    --policy-arn <span class="nv">$POLICY_ARN</span>
</code></pre></div>
</td></tr></table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Set the <code>$IAM_ROLE</code> variable above to the ARN of the IAM Role the
ACK service controller will run as.</p>
</div>
<p>Some services may need an additional inline policy, specified in
<code>config/iam/additional-policy</code>, in addition to the managed policy from
<code>recommended-policy-arn</code>. For example, the service controller may require
<code>iam:PassRole</code> permission in order to pass an execution role which will be
 assumed by the AWS service. With <code>$IAM_ROLE</code> still set, run the script at
<code>config/iam/additional-policy</code> if there is one to create the inline policy.</p>
<h2 id="cross-account-resource-management">Cross-account resource management<a class="headerlink" href="#cross-account-resource-management" title="Permanent link">&para;</a></h2>
<p>ACK service controllers can manage resources in different AWS accounts. To enable and start using this feature, as an administrator, you will need to:
1. Configure your AWS accounts, where the resources will be managed.
2. Create a <code>ConfigMap</code> to map AWS accounts with the Role ARNs that needs to be assumed
3. Annotate namespaces with AWS Account IDs</p>
<p>For detailed information about how ACK service controllers manage resource in multiple AWS accounts, please refer to <a href="https://github.com/aws/aws-controllers-k8s/blob/main/docs/design/proposals/carm/cross-account-resource-management.md">CARM</a> design document.</p>
<h3 id="setting-up-aws-accounts">Setting up AWS accounts<a class="headerlink" href="#setting-up-aws-accounts" title="Permanent link">&para;</a></h3>
<p>AWS Account administrators should create/configure IAM roles to allow ACK service controllers to assume Roles in different AWS accounts.</p>
<p>For example, to allow account A (000000000000) to create s3 buckets in account B (111111111111) you can use the following commands</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1"># Using account B credentials</span>
aws iam create-role --role-name s3FullAccess <span class="se">\</span>
  --assume-role-policy-document <span class="s1">&#39;{&quot;Version&quot;: &quot;2012-10-17&quot;,&quot;Statement&quot;: [{ &quot;Effect&quot;: &quot;Allow&quot;, &quot;Principal&quot;: {&quot;AWS&quot;: &quot;arn:aws:iam::000000000000:role/roleA-production&quot;}, &quot;Action&quot;: &quot;sts:AssumeRole&quot;}]}&#39;</span>
aws iam attach-role-policy --role-name s3FullAccess <span class="se">\</span>
  --policy-arn <span class="s1">&#39;arn:aws:iam::aws:policy/service-role/AmazonS3FullAccess&#39;</span>
</code></pre></div>
</td></tr></table>
<h3 id="map-aws-accounts-with-their-associated-role-arns">Map AWS Accounts with their associated Role ARNs<a class="headerlink" href="#map-aws-accounts-with-their-associated-role-arns" title="Permanent link">&para;</a></h3>
<p>After you will need to create a <code>ConfigMap</code> to associate each AWS Account ID with the role ARN that needs be assumed, in order to manage resources in that particular account.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: ConfigMap</span>
<span class="s">metadata:</span>
<span class="s">  name: ack-role-account-map</span>
<span class="s">  namespace: ack-system</span>
<span class="s">data:</span>
<span class="s">  &quot;111111111111&quot;: arn:aws:iam::111111111111:role/s3FullAccess</span>
<span class="s">EOF</span>
</code></pre></div>
</td></tr></table>
<h3 id="bind-accounts-to-namespaces">Bind accounts to namespaces<a class="headerlink" href="#bind-accounts-to-namespaces" title="Permanent link">&para;</a></h3>
<p>To bind AWS accounts to a specific <code>Namespace</code> you will have to annotate the <code>Namespace</code> with an AWS Account ID. For example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Namespace</span>
<span class="s">metadata:</span>
<span class="s">  name: production</span>
<span class="s">  annotations:</span>
<span class="s">    services.k8s.aws/owner-account-id: 111111111111</span>
<span class="s">EOF</span>
</code></pre></div>
</td></tr></table>
<p>For existing namespaces you can also run:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>kubectl annotate namespace production services.k8s.aws/owner-account-id<span class="o">=</span><span class="m">111111111111</span>
</code></pre></div>
</td></tr></table>
<h3 id="create-resource-in-different-aws-accounts">Create resource in different AWS accounts<a class="headerlink" href="#create-resource-in-different-aws-accounts" title="Permanent link">&para;</a></h3>
<p>Now to create resources in account B you will have to create your CRs in the associated <code>Namespace</code>.</p>
<p>For example to create an s3 bucket in account B you can run the following command:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: s3.services.k8s.aws/v1alpha1</span>
<span class="s">kind: Bucket</span>
<span class="s">metadata:</span>
<span class="s">  name: my-bucket</span>
<span class="s">  namespace: production</span>
<span class="s">spec:</span>
<span class="s">  name: my-bucket</span>
<span class="s">EOF</span>
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Amazon
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://twitter.com/awscloud" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1609d9a.min.js"></script>
      
    
  </body>
</html>